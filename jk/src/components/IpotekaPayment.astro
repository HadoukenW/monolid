---
 const {title} = Astro.props
---

<section aria-labelledby="ipoteka__title">
    <div class="container">
        <h2 id="ipoteka__title">Купить в ипотеку</h2>

        <ul>
            <li>Ставка от 4,6 % до 30 лет</li>
            <li>Подберем ипотеку на выгодных условиях</li>
        </ul>

        <p class="preform__title">Получите расчет ежемесячного платежа по ипотеке</p>

        <form class="ipoteka__form" data-sd={title}>
            <label>Количество комнат
                <select id="ipotekaFormSelect">
                    <option value="1 комната">1 комната</option>
                    <option value="2 комнаты">2 комнаты</option>
                    <option value="3 комнаты">3 комнаты</option>
                    <option value="4 комнаты+">4 комнаты+</option>
                  </select>
            </label>
            <label >Первоначальный взнос
                <input id="ipotekaFormPayment" min="0" type="number" placeholder="100000" required/>
            </label>
            <label >Срок, лет
                <input id="ipotekaFormPeriod" min="0" max="30" type="text" placeholder="0 лет" required/>
            </label>
            <label >Имя
                <input id="ipotekaFormName" name="name"  type="text" placeholder="Ваше имя" required/>
            </label>
            <label >Телефон
                <input id="ipotekaFormPhone" name="phone" class="phoneMask" type="tel" placeholder="Ваш телефон" required/>
            </label>
            <button>Рассчитать ипотеку</button>
        </form>
        <p class="personalData">Нажимая на кнопку, вы даете согласие на обработку персональных данных и соглашаетесь c политикой конфиденциальности</p>
    </div>
</section>

<style lang="scss">
    section {
        padding: var(--section-padding) 0;
        background-color: var(--primary);
        color: var(--primary);
        ul {
            display: flex;
            flex-direction: column;
            gap: 15px;
            
            li {
                position: relative;
                display: flex;
                gap: 10px;
                color: var(--headers-primary);
                &::before {
                    content: '—';
                }
            }
        }
            h2 {
                font-weight: 500;
                text-align: center;
                font-size: var(--header-clamp);
                margin-bottom: 40px;
                color: var(--headers-primary);
            }
            p {
                margin: 20px 0;
                color: var(--headers-primary);
            }
            form {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 24px;

                @media(max-width: 992px) {
                    grid-template-columns: repeat(2, 1fr);
                }
                @media(max-width: 600px) {
                    grid-template-columns: repeat(1, 1fr);
                    gap: 20px;
                }

                label {
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                    color: var(--headers-primary);
                }

                select, input {
                    padding: 16px 20px;
                    border: 1px solid #d3dad7;
                    font-weight: 400;
                    font-size: 16px;
                    text-transform: capitalize;

                    &::placeholder {
                        font-weight: 400;
                        font-size: 16px;
                        text-transform: capitalize;
                    }
                }

                button {
                    padding: 17px;
                    background: var(--btn-primary);
                    font-weight: 700;
                    font-size: 18px;
                    color: var(--primary);
                    max-height: 52px;
                    height: 100%;
                    transition: .3s ease background;
                    align-self: end;
                    // @media(max-width: 992px) {
                    //     align-self: unset;
                    //     margin-top: 15px;
                    // }

                    &:hover {
                        background: #0b1099;
                    }
                }
            }
            .personalData {
                font-size: 12px;
            }
            
    }
</style>


<script>
    const ipotekaForm: any = document.querySelector(".ipoteka__form");
    const ipotekasd = ipotekaForm.dataset.sd
    const ipotekaFormSelect = document.querySelector("#ipotekaFormSelect")
    const ipotekaFormPayment = document.querySelector("#ipotekaFormPayment")
    const ipotekaFormPeriod = document.querySelector("#ipotekaFormPeriod")
	const ipotekaPhone = document.querySelector('#ipotekaFormPhone')
	const ipotekaName = document.querySelector('#ipotekaFormName')
	async function sendData() {
	// Associate the FormData object with the form element
	const formData = new FormData(ipotekaForm);

	try {
		const response = await fetch(`https://monolid.yucrm.ru/api/orders/post?&phone=9999999999&name=name&object_name=${ipotekasd}&message=Расчитать ипотеку: Количество комнат - ${ipotekaFormSelect.value}, Первоначальный взнос - ${ipotekaFormPayment.value}, Срок/лет - ${ipotekaFormPeriod.value}&oauth_token=afd0bcd4ee3a219f27812dd4d20a550c`, {
		method: "POST",
		// Set the FormData instance as the request body
		body: formData,
		});
		console.log(await response.json());
	} catch (e) {
		console.error(e);
	}
	}

	// Take over form submission
	ipotekaForm.addEventListener("submit", (event) => {
	event.preventDefault();
	sendData();
    ipotekaFormSelect.value = '1 комната'
    ipotekaFormPayment.value = ''
    ipotekaFormPeriod.value = ''
	ipotekaPhone.value = ''
	ipotekaName.value = ''
	});
</script>